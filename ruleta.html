<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ruleta 3D - Pro Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: white; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        #info { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 10px; border: 1px solid #ffd700; pointer-events: auto; }
        .balance { font-size: 24px; color: #ffd700; font-weight: bold; }

        #betting-container { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            transition: all 0.4s ease; pointer-events: auto; width: 600px;
        }
        .hidden { transform: translateX(-50%) translateY(150%); opacity: 0; }

        #betting-area { 
            background: rgba(0, 40, 10, 0.95); padding: 20px; border-radius: 15px; 
            border: 2px solid #daa520; display: flex; flex-direction: column; align-items: center; gap: 12px;
        }

        /* Fichas */
        .chip-selector { display: flex; gap: 10px; margin-bottom: 5px; }
        .chip { 
            width: 45px; height: 45px; border-radius: 50%; border: 3px dashed white; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 14px; transition: 0.2s;
        }
        .chip.active { transform: translateY(-10px); border-style: solid; box-shadow: 0 5px 15px rgba(255,255,255,0.4); }
        .chip-10 { background: #3498db; } .chip-50 { background: #e67e22; }
        .chip-100 { background: #9b59b6; } .chip-500 { background: #c0392b; }

        /* Tablero */
        .numbers-grid { display: grid; grid-template-columns: repeat(13, 1fr); gap: 4px; }
        .num-btn { 
            width: 40px; height: 50px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 14px; position: relative;
        }
        .bet-badge { 
            position: absolute; top: -5px; right: -5px; background: #ffd700; color: black; 
            font-size: 9px; padding: 2px 4px; border-radius: 10px; display: none; z-index: 5;
        }

        .red { background: #c0392b; } .black { background: #2c3e50; } .green { background: #27ae60; }
        
        .action-btn { background: #444; color: white; border: 1px solid #777; padding: 10px 15px; cursor: pointer; font-size: 12px; font-weight: bold; border-radius: 5px; flex: 1; position: relative; }
        #spin-btn { background: #ffd700; color: black; border: none; padding: 15px 80px; font-size: 20px; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        #win-msg { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.98); padding: 40px; border-radius: 20px; text-align: center;
            display: none; border: 4px solid #ffd700; pointer-events: auto; z-index: 1000;
        }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="info">
        <div class="balance">ðŸ’° $<span id="balance-val">1000</span></div>
        <div id="active-total" style="color: #00ff00; font-size: 14px; font-weight: bold;">Total Apostado: $0</div>
    </div>

    <div id="win-msg">
        <h2 style="color: #ffd700; margin:0">RESULTADO</h2>
        <h1 id="num-result" style="font-size: 80px; margin: 10px 0;">-</h1>
        <p id="win-amount" style="font-size: 22px; margin-bottom: 20px; font-weight: bold;"></p>
        <button onclick="closeWinMsg()" style="background: white; color: black; padding: 10px 40px; font-weight: bold; cursor: pointer; border: none; border-radius: 5px;">CONTINUAR</button>
    </div>

    <div id="betting-container">
        <div id="betting-area">
            <div class="chip-selector">
                <div class="chip chip-10 active" onclick="selectChip(10)">10</div>
                <div class="chip chip-50" onclick="selectChip(50)">50</div>
                <div class="chip chip-100" onclick="selectChip(100)">100</div>
                <div class="chip chip-500" onclick="selectChip(500)">500</div>
            </div>

            <div class="numbers-grid" id="grid-container"></div>

            <div style="display:flex; gap:8px; width: 100%;">
                <button class="action-btn red" onclick="addBet('rojo', 2)">ROJO <span class="bet-badge" id="badge-rojo">0</span></button>
                <button class="action-btn black" onclick="addBet('negro', 2)">NEGRO <span class="bet-badge" id="badge-negro">0</span></button>
                <button class="action-btn" onclick="addBet('par', 2)">PAR <span class="bet-badge" id="badge-par">0</span></button>
                <button class="action-btn" onclick="addBet('impar', 2)">IMPAR <span class="bet-badge" id="badge-impar">0</span></button>
                <button id="repeat-btn" class="action-btn" style="background: #2980b9" onclick="repeatLastBet()" disabled>REPETIR</button>
                <button class="action-btn" style="background: #666" onclick="clearBets()">BORRAR</button>
            </div>
            <button id="spin-btn" onclick="spinWheel()">GIRAR RULETA</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let savedBalance = localStorage.getItem("balance");
let balance = savedBalance !== null ? parseInt(savedBalance) : 1000;
let currentBets = [], lastBets = [], selectedChip = 10;

let winIdx = 0, isSpinning = false, ballAngle = 0, ballSpeed = 0;
const reds = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
const wheelOrder = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];

function saveBalance(){
    localStorage.setItem("balance", balance);
}


// Setup Tablero con Badges
const grid = document.getElementById('grid-container');
[...wheelOrder].sort((a,b)=>a-b).forEach(n => {
    const btn = document.createElement('div');
    btn.className = `num-btn ${n === 0 ? 'green' : (reds.includes(n) ? 'red' : 'black')}`;
    btn.innerHTML = `${n} <span class="bet-badge" id="badge-${n}">0</span>`;
    btn.onclick = () => addBet(n.toString(), 36);
    grid.appendChild(btn);
});

function selectChip(val) {
    selectedChip = val;
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
}

function addBet(type, m) {
    if (balance >= selectedChip) {
        balance -= selectedChip;
        saveBalance();
        const existingBet = currentBets.find(b => b.type === type);
        if (existingBet) {
            existingBet.amount += selectedChip;
        } else {
            currentBets.push({ type, multiplier: m, amount: selectedChip });
        }
        updateUI();
    }
}

function clearBets() {
    currentBets.forEach(b => balance += b.amount);
    saveBalance();
    currentBets = [];
    updateUI();
}

function repeatLastBet() {
    if (isSpinning || lastBets.length === 0) return;
    const total = lastBets.reduce((s, b) => s + b.amount, 0);
    if (balance >= total) {
        currentBets.forEach(b => balance += b.amount);
        currentBets = lastBets.map(b => ({...b}));
        balance -= total;
        saveBalance();
        updateUI();
    }
}

function updateUI() {
    document.getElementById('balance-val').innerText = balance;
    let totalApostado = 0;
    
    document.querySelectorAll('.bet-badge').forEach(b => { b.innerText = "0"; b.style.display = "none"; });
    
    currentBets.forEach(bet => {
        totalApostado += bet.amount;
        const badge = document.getElementById(`badge-${bet.type}`);
        if (badge) {
            badge.innerText = `$${bet.amount}`;
            badge.style.display = "block";
        }
    });
    
    document.getElementById('active-total').innerText = `Total Apostado: $${totalApostado}`;
    document.getElementById('repeat-btn').disabled = (lastBets.length === 0 || isSpinning);
}

// Three.js
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const wheelGroup = new THREE.Group();
const wheelBase = new THREE.Mesh(new THREE.CylinderGeometry(5, 5, 0.8, 64), new THREE.MeshPhongMaterial({ color: 0x1a1a1a, shininess: 50 }));
wheelGroup.add(wheelBase);

wheelOrder.forEach((num, i) => {
    const angle = (i / 37) * Math.PI * 2;
    const box = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.25, 0.6), new THREE.MeshPhongMaterial({ color: num === 0 ? 0x27ae60 : (reds.includes(num) ? 0x96281b : 0x000000) }));
    box.position.set(Math.cos(angle) * 4.4, 0.4, Math.sin(angle) * 4.4);
    box.rotation.y = -angle + Math.PI/2;
    wheelGroup.add(box);

    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
    canvas.width = 64; canvas.height = 64; ctx.fillStyle = "white"; ctx.font = "bold 38px Arial"; ctx.textAlign = "center";
    ctx.fillText(num, 32, 45);
    const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: new THREE.CanvasTexture(canvas) }));
    sprite.scale.set(0.75, 0.75, 1); sprite.position.set(Math.cos(angle) * 3.6, 0.55, Math.sin(angle) * 3.6);
    wheelGroup.add(sprite);
});
scene.add(wheelGroup);

const ball = new THREE.Mesh(new THREE.SphereGeometry(0.18, 32, 32), new THREE.MeshPhongMaterial({ color: 0xffffff, shininess: 100 }));
wheelGroup.add(ball);
ball.position.set(Math.cos(0)*4.4, 0.5, Math.sin(0)*4.4);

scene.add(new THREE.PointLight(0xffffff, 1.5, 100).clone().translateY(10));
scene.add(new THREE.AmbientLight(0x404040));
camera.position.set(0, 12, 4); camera.lookAt(0, 0, 0);

function animate() {
    requestAnimationFrame(animate);
    wheelGroup.rotation.y += 0.015;
    if (isSpinning) {
        ballSpeed *= 0.982; ballAngle -= ballSpeed;
        ball.position.set(Math.cos(ballAngle)*4.75, 0.6, Math.sin(ballAngle)*4.75);
        if (ballSpeed < 0.05) stopBall();
    }
    renderer.render(scene, camera);
}
animate();

function stopBall() {
    isSpinning = false;
    wheelGroup.add(ball);
    const localAngle = (winIdx / 37) * Math.PI * 2;
    ball.position.set(Math.cos(localAngle) * 4.4, 0.5, Math.sin(localAngle) * 4.4);
    showResult();
}

function spinWheel() {
    if (isSpinning || currentBets.length === 0) return;
    lastBets = currentBets.map(b => ({...b}));
    const globalPos = new THREE.Vector3();
    ball.getWorldPosition(globalPos);
    scene.add(ball);
    ball.position.copy(globalPos);
    ballAngle = Math.atan2(ball.position.z, ball.position.x);
    document.getElementById('betting-container').classList.add('hidden');
    winIdx = Math.floor(Math.random() * 37);
    ballSpeed = 0.52; isSpinning = true;
}

function showResult() {
    const winNum = wheelOrder[winIdx];
    let totalWon = 0;
    currentBets.forEach(bet => {
        let won = false;
        if (bet.type === 'rojo' && reds.includes(winNum)) won = true;
        else if (bet.type === 'negro' && !reds.includes(winNum) && winNum !== 0) won = true;
        else if (bet.type === 'par' && winNum !== 0 && winNum % 2 === 0) won = true;
        else if (bet.type === 'impar' && winNum % 2 !== 0) won = true;
        else if (bet.type === winNum.toString()) won = true;
        if (won) totalWon += bet.amount * bet.multiplier;
    });
    balance += totalWon;
    saveBalance();
    setTimeout(() => {
        document.getElementById('num-result').innerText = winNum;
        document.getElementById('num-result').style.color = winNum === 0 ? '#27ae60' : (reds.includes(winNum) ? '#e74c3c' : '#888');
        document.getElementById('win-amount').innerText = totalWon > 0 ? `ðŸ’° Â¡GANASTE $${totalWon}!` : "Suerte para la prÃ³xima";
        document.getElementById('win-msg').style.display = 'block';
        updateUI();
    }, 400);
}

function closeWinMsg() {
    document.getElementById('win-msg').style.display = 'none';
    document.getElementById('betting-container').classList.remove('hidden');
    currentBets = [];
    updateUI();
}
</script>
</body>
</html>
